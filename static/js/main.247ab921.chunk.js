(this["webpackJsonpthsr-app"]=this["webpackJsonpthsr-app"]||[]).push([[0],{32:function(t,e,a){t.exports=a(91)},69:function(t,e){},90:function(t,e,a){},91:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),o=a(7),s=a.n(o),r=a(6),c=(a(37),a(31)),l=a(9),m=a(4),d=a(5),u=a.n(d),p=a(3),h=a.n(p),S=a(1),g=a.n(S);a(59);function v({date:t,stations:e,originStation:a,destinationStation:n,handleInputChange:o,swapLocation:s}){const r=[],c=[];return e&&e.forEach(t=>{r.push(i.a.createElement("option",{key:"originStation".concat(t.stationID),value:t.stationID},t.stationName.zhTw)),c.push(i.a.createElement("option",{key:"destinationStation".concat(t.stationID),value:t.stationID},t.stationName.zhTw))}),i.a.createElement("div",{className:"control"},i.a.createElement("div",{className:"form-group"},i.a.createElement("span",null,"\u65e5\u671f:"),i.a.createElement("input",{name:"date",id:"date",type:"date",min:g()().format("YYYY-MM-DD"),max:g()().add(8,"month").format("YYYY-MM-DD"),value:t,onChange:o})),i.a.createElement("div",{className:"form-group"},i.a.createElement("span",null,"\u8d77\u9ede:"),i.a.createElement("select",{name:"originStation",id:"originStation",value:a,onChange:o},r)),i.a.createElement("div",{className:"form-group"},i.a.createElement("button",{id:"swapLocation",type:"button",className:"control__swap",onClick:s},i.a.createElement("span",{className:"glyphicon glyphicon-sort"}))),i.a.createElement("div",{className:"form-group"},i.a.createElement("span",null,"\u7d42\u9ede:"),i.a.createElement("select",{name:"destinationStation",id:"destinationStation",value:n,onChange:o},c)))}v.defaultProps={originStation:"1030",destinationStation:"1060"};var f=v;function E(t){return t&&t.data.status&&t.data.result?t.data.result:0}function w(t){return t.minutes()+60*t.hours()}function T(t){const e=t.date,a=t.times,n=t.finalData,i=t.travelTimeDSC,o=t.active,s=n.map(t=>{const n=t.departureTime,i=t.trainNo;let o,s,r,c={};return a&&a.length&&(c=function(t,e){const a=e.filter(e=>e.dailyTrainInfo.trainNo===t);return!!a[0]&&a[0].destinationStopTime}(i,a),c&&(o=c.arrivalTime,s=c.stationName.zhTw)),n&&o&&(r=function(t,e,a){return g.a.utc(g()("".concat(t," ").concat(a),"YYYY-MM-DD HH:mm").diff(g()("".concat(t," ").concat(e),"YYYY-MM-DD HH:mm:ss"))).format("HH:mm")}(e,n,o)),Object(m.a)(Object(m.a)({},t),{},{destinationStationName:s,arrivalTime:o,travelTime:r})}).filter(t=>t.arrivalTime);return o?i?s.sort((t,a)=>w(g()("".concat(e," ").concat(a.travelTime)))-w(g()("".concat(e," ").concat(t.travelTime)))):s.sort((t,a)=>w(g()("".concat(e," ").concat(t.travelTime)))-w(g()("".concat(e," ").concat(a.travelTime)))):s}class b extends n.Component{constructor(t){super(t),this.state={sortActiveMode:0,departureTimeDSC:!0,travelTimeDSC:!0},this.toggleSortDepartureTime=()=>{const t=this.state.departureTimeDSC;this.setState({departureTimeDSC:!t,sortActiveMode:0})},this.toggleSortTravelTime=()=>{const t=this.state.travelTimeDSC;this.setState({travelTimeDSC:!t,sortActiveMode:1})}}render(){const t=this.props,e=t.date,a=t.times,n=t.prices,o=t.isLoading,s=t.isSubmit,r=t.destinationStation,c=t.availableSeats,l=this.state,m=l.departureTimeDSC,d=l.travelTimeDSC,u=l.sortActiveMode;let p;if(p=o&&s?i.a.createElement("tr",{id:"row-searching"},i.a.createElement("td",{colSpan:"6",style:{textAlign:"center"}},"\u67e5\u8a62\u4e2d")):!o&&s?i.a.createElement("tr",{id:"row-nodata"},i.a.createElement("td",{colSpan:"6",style:{textAlign:"center"}},"\u7121\u5ea7\u4f4d\u53ef\u8ca9\u552e")):i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"6",style:{textAlign:"center"}},"\u689d\u4ef6\u5df2\u8b8a\u66f4\u8acb\u91cd\u65b0\u9001\u51fa\u67e5\u8a62")),c&&c.length&&!o&&s){let t=c;t=function(t){const e=t.date,a=t.finalData,n=t.departureTimeDSC,i=t.active,o=a.filter(t=>g()("".concat(e," ").concat(t.departureTime)).unix()>g()().unix());return i?n?o.sort((t,a)=>w(g()("".concat(e," ").concat(t.departureTime)))-w(g()("".concat(e," ").concat(a.departureTime)))):o.sort((t,a)=>w(g()("".concat(e," ").concat(a.departureTime)))-w(g()("".concat(e," ").concat(t.departureTime)))):o}({date:e,finalData:t,departureTimeDSC:m,active:0===u}),t=function(t,e){return e.filter(e=>{const a=e.stopStations,n=a.findIndex(e=>e.stationID===t);return n>=0?(e.hasStandardSeat="Full"!==a[n].standardSeatStatus,"Full"!==a[n].standardSeatStatus||"Full"!==a[n].businessSeatStatus):[]})}(r,t),t=T({date:e,times:a,finalData:t,travelTimeDSC:d,active:1===u}),p=t.map(t=>{const e=t.departureTime,a=t.stationName,o=t.destinationStationName,s=t.arrivalTime,r=t.hasStandardSeat,c=t.travelTime;let l;return n&&(l=r?n[0].fares.map(t=>"".concat(t.ticketType,":").concat(t.price)).toString():n[0].fares.filter(t=>"\u6a19\u6e96"!==t.ticketType).map(t=>"".concat(t.ticketType,":").concat(t.price)).toString()),i.a.createElement("tr",{key:e},i.a.createElement("td",null,"".concat(a.zhTw,"|").concat(o)),i.a.createElement("td",null,e),i.a.createElement("td",null,s),i.a.createElement("td",null,c),i.a.createElement("td",null,l))})}return i.a.createElement("div",{className:"table-responsive"},i.a.createElement("table",{className:"table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"\u8d77|\u7d42\u9ede"),i.a.createElement("th",{id:"departureTime",className:"pointer",onClick:this.toggleSortDepartureTime},i.a.createElement("span",null,"\u767c\u8eca"),i.a.createElement("span",{className:m?"arrow arrow--asc":"arrow arrow--dsc"})),i.a.createElement("th",null,"\u5230\u9054"),i.a.createElement("th",{id:"travelTime",className:"pointer",onClick:this.toggleSortTravelTime},i.a.createElement("span",null,"\u7e3d\u6642\u9593"),i.a.createElement("span",{className:d?"arrow arrow--dsc":"arrow arrow--asc"})),i.a.createElement("th",null,"\u7968\u50f9"))),i.a.createElement("tbody",null,p)))}}b.defaultProps={isLoading:!0,isSubmit:!0};var C=b,y=a(15),D=a.n(y),N=a(8);let k=!1;const Y=u.a.create({baseURL:"https://ptx.transportdata.tw/MOTC/v2/Rail/THSR",timeout:8e3,responseType:"json",paramsSerializer:t=>D.a.stringify(t,{indices:!1})});Y.interceptors.response.use(t=>function(t){return 200===t.status?t.data:this.parseError(t.data.messages)}(Object(N.camelizeKeys)(t)),t=>{return console.warn("Error status",t.response),t.response?(403===t.response.status?k||h()({type:"error",title:"\u8acb\u66f4\u63db\u65e5\u671f",showConfirmButton:!1,showCloseButton:!0,onClose:()=>{k=!1}}):500===t.response.status&&(k||h()({type:"error",title:"\u9023\u7dda\u6216\u4f3a\u670d\u5668\u767c\u751f\u932f\u8aa4",showConfirmButton:!1,showCloseButton:!0,onClose:()=>{k=!1}})),(e=t.response.data)?e instanceof Array?Promise.reject({messages:e}):Promise.reject({messages:[e]}):Promise.reject({messages:["\u932f\u8aa4"]})):Promise.reject(t);var e});var j=Y,M=(a(71),a(29)),I=a.n(M),L=a(30),O=a.n(L);let x=!1;var A=I()({stations:{url:"/Station",options:{headers:{"Content-Type":"application/json"}}}}).use("responseHandler",(t,e)=>{if(t)console.log(t),403===t.status?x||h()({type:"error",title:"\u8acb\u66f4\u63db\u65e5\u671f",showConfirmButton:!1,showCloseButton:!0,onClose:()=>{x=!1}}):(500===t.status||t)&&(x||h()({type:"error",title:"\u9023\u7dda\u6216\u4f3a\u670d\u5668\u767c\u751f\u932f\u8aa4",showConfirmButton:!1,showCloseButton:!0,onClose:()=>{x=!1}}));else if(e&&e&&e.length>0)return{status:1,result:Object(N.camelizeKeys)(e)};return{status:0}}).use("options",(t,e,a)=>({headers:{"Content-Type":"application/json"}})).use("fetch",O()(fetch)).use("rootUrl","https://ptx.transportdata.tw/MOTC/v2/Rail/THSR");a(90);class B extends n.Component{constructor(t){super(t),this.state={isLoading:!0,isSubmit:!1,date:g()().format("YYYY-MM-DD"),originStation:"",destinationStation:"",availableSeats:[],updateTime:"",times:[],prices:[]},this.handleInputChange=this.handleInputChange.bind(this),this.submit=this.submit.bind(this),this.swapLocation=()=>{const t=this.state,e=t.originStation,a=t.destinationStation;this.setState({originStation:a,destinationStation:e},this.submit)}}componentDidMount(){(0,this.props.dispatch)(A.actions.stations.sync(()=>{const t=E(this.props.stations);t&&this.setState({originStation:t[4].stationID,destinationStation:t[10].stationID},()=>{this.submit()})}))}handleInputChange(t){const e=this,a=t.target,n=a.type,i=a.name,o=a.checked,s=a.value,r=this.state,c=r.originStation,l=r.destinationStation;t.preventDefault(),"originStation"!==i&&"destinationStation"!==i||"originStation"===i&&s!==l||"destinationStation"===i&&s!==c?this.setState({isSubmit:!1,[i]:"checkbox"===n?o:s},e.submit):h()({type:"info",timer:1e3,title:"\u8d77\u9ede\u548c\u7d42\u9ede\u9700\u4e0d\u540c",showConfirmButton:!1,showCloseButton:!0})}submit(){const t=this.state,e=t.originStation,a=t.destinationStation,n=t.date;this.setState({isLoading:!0,isSubmit:!0},()=>{u.a.all([j.get("/AvailableSeatStatusList/".concat(e)),j.get("/ODFare/".concat(e,"/to/").concat(a)),j.get("/DailyTimetable/OD/".concat(e,"/to/").concat(a,"/").concat(n))]).then(u.a.spread((t,e,a)=>{let n={};t.availableSeats&&t.availableSeats.length&&(n=JSON.parse(JSON.stringify(t))),this.setState(Object(m.a)(Object(m.a)({},n),{},{prices:e||[],times:a||[],isLoading:!1}))}))})}render(){const t=this.props.stations,e=this.state,a=e.date,n=e.times,o=e.prices,s=e.originStation,r=e.destinationStation,c=e.updateTime,l=e.isLoading,m=e.isSubmit,d=e.availableSeats;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"App container"},i.a.createElement("div",{className:"sticky desktop--hide"},i.a.createElement(f,{date:a,stations:E(t)||[],originStation:s,destinationStation:r,handleInputChange:this.handleInputChange,swapLocation:this.swapLocation})),i.a.createElement("div",{className:"row content--mobile"},i.a.createElement("div",{className:"col-md-8 col-sm-7 col-xs-12"},i.a.createElement("h2",{id:"title"},"\u9ad8\u9435\u67e5\u8a62"),i.a.createElement(C,{isLoading:l,isSubmit:m,date:a,times:n,prices:o,destinationStation:r,availableSeats:d})),i.a.createElement("div",{className:"col-md-4 col-sm-5 col-xs-12 sticky mobile--hide"},i.a.createElement(f,{date:a,stations:E(t)||[],originStation:s,destinationStation:r,handleInputChange:this.handleInputChange,swapLocation:this.swapLocation})))),i.a.createElement("div",{className:"container-fluid"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12 center footer"},i.a.createElement("i",{className:"glyphicon glyphicon-time"}),i.a.createElement("span",null," \u66f4\u65b0\u6642\u9593:".concat(g()(c).format("YYYY-MM-DD HH:mm:ss"))),i.a.createElement("br",null)))))}}var H=Object(l.b)(t=>({stations:t.stations}))(B);const P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function R(t,e){navigator.serviceWorker.register(t).then(t=>{t.onupdatefound=()=>{const a=t.installing;null!=a&&(a.onstatechange=()=>{"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("\u7db2\u9801\u7248\u672c\u66f4\u65b0\uff0c\u8acb\u95dc\u9589\u76f8\u95dc\u8996\u7a97\u5f8c\u91cd\u65b0\u958b\u555f http://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(t=>{console.error("Error during service worker registration:",t)})}const z=Object(r.b)(A.reducers),W=Object(r.d)(z,Object(r.c)(Object(r.a)(c.a)));s.a.render(i.a.createElement(l.a,{store:W},i.a.createElement(H,null)),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/thsr-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("/thsr-app","/service-worker.js");P?(!function(t,e){fetch(t).then(a=>{const n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(t=>{t.unregister().then(()=>{window.location.reload()})}):R(t,e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):R(e,t)})}}()}},[[32,1,2]]]);
//# sourceMappingURL=main.247ab921.chunk.js.map